<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
    <style>
        /* Estilo simples para a janela de erro */
        #erroModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        #erroModal .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }

        #erroModal button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Painel</h1>
    <input type="text" id="texto" placeholder="Digite algo aqui">
    <button id="enviar">Enviar</button>
    <br><br>
    <button id="sair">Sair</button>

    <!-- Janela de erro -->
    <div id="erroModal">
        <div class="modal-content">
            <h3>Erro</h3>
            <p id="erroMensagem">Ocorreu um erro!</p>
            <button onclick="document.getElementById('erroModal').style.display='none'">Fechar</button>
        </div>
    </div>

    <script>
        // Defina a URL e a chave do seu Supabase
        const supabaseUrl = 'https://uczjqfezherhudrrznti.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjempxZmV6aGVyaHVkcnJ6bnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODUwOTEsImV4cCI6MjA3NDU2MTA5MX0.snnWr64nQG0WTk4-BoqH-N8T0e9-xVV8eQiG_1Hxc98';

        // Inicializar o cliente supabase corretamente (depois que o script for carregado)
        let supabase;

        // Aguardar a biblioteca Supabase ser carregada
        window.onload = function() {
            supabase = Supabase.createClient(supabaseUrl, supabaseKey); // Certificando-se de que o supabase é inicializado após o carregamento

            // Agora é seguro utilizar supabase
            // Verificar se o usuário está logado
            if(sessionStorage.getItem('logado') !== '1'){
                alert('Acesso negado! Faça login.');
                location.href = 'login.html';
            }

            // Enviar texto
            document.getElementById('enviar').addEventListener('click', async function(){
                const texto = document.getElementById('texto').value;
                if(!texto) return alert('Digite algum texto!');

                // Adiciona a data de atualização
                const atualizado_em = new Date().toISOString();

                // Insere o novo texto com a data de atualização
                const { data, error } = await supabase.from('painel_texto').insert([{
                    texto,
                    atualizado_em
                }]);

                if(error){
                    exibirErro('Erro ao enviar: ' + error.message);
                } else {
                    alert('Texto enviado com sucesso!');
                    // Atualiza a página para refletir a inserção
                    carregarTexto();
                }
            });

            // Carregar último texto no input
            async function carregarTexto(){
                const { data, error } = await supabase.from('painel_texto')
                    .select('*')
                    .order('atualizado_em', {ascending:false})
                    .limit(1);

                if(error){
                    exibirErro('Erro ao carregar dados: ' + error.message);
                } else if(data && data.length > 0){
                    document.getElementById('texto').value = data[0].texto;
                } else {
                    document.getElementById('texto').value = 'Nenhum texto encontrado.';
                }
            }
            carregarTexto();

            // Sair
            document.getElementById('sair').addEventListener('click', function(){
                sessionStorage.removeItem('logado');
                location.href = 'login.html';
            });

            // Função para exibir o erro na tela
            function exibirErro(mensagem){
                document.getElementById('erroMensagem').innerText = mensagem;
                document.getElementById('erroModal').style.display = 'flex';
            }
        }
    </script>
</body>
</html>
